{% extends 'base.html' %}

{% block content_class %}p-0{% endblock %}

{% block content %}

<div class="container-fluid g-0 m-0 w-100 full-width-container">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
<!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
<div class="bg-light p-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
  <h2 class="mb-0 fs-4">
    <i class="fas fa-file-invoice ms-2"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #{{ order.reference_id | safe }}
  </h2>
  <div>
    <!-- Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© HTML -->
    <a href="{{ url_for('orders.download_orders_html', order_ids=order.id) }}" 
       class="btn btn-primary btn-sm" target="_blank">
      <i class="fas fa-print ms-1"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨
    </a>
    

    

<!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† -->
<a href="{{ url_for('orders.download_addresses_pdf', order_ids=order.id) }}" 
   class="btn btn-info btn-sm">
  <i class="fas fa-download ms-1"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
</a>


    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠ -->
    <a href="{{ url_for('orders.index') }}" class="btn btn-outline-secondary btn-sm">
      <i class="fas fa-arrow-left ms-1"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø·Ù„Ø¨Ø§Øª
    </a>
  </div>
</div>
  <div class="row g-0 mx-0">
    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
    <div class="col-12 p-3">
      <div class="card shadow-sm mb-3 border-0">
        <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap py-2">
          <h5 class="mb-0 fs-5">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h5>
          <span class="badge rounded-pill bg-{{ order.status.slug | replace('under_review', 'warning') | replace('in_progress', 'info') | replace('completed', 'success') | replace('payment_pending', 'warning') | replace('shipped', 'primary') | replace('delivered', 'success') | replace('canceled', 'danger') | replace('restored', 'secondary') }}">
            {{ order.status.name | safe }}
          </span>
        </div>
        <div class="card-body p-2">
          <h5 class="border-bottom pb-2 mb-2 fs-5">
            <i class="fas fa-boxes ms-2"></i>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ({{ order.order_items | length }})
          </h5>
<!-- ÙÙŠ Ù…Ù„Ù order_details.html -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h5>
    </div>
    <div class="card-body">
        <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
        <div class="row mb-3">
            <div class="col-md-6">
                <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong>
                <span class="badge bg-primary">{{ order.payment_method }}</span>
            </div>
        </div>
        
        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø¨ -->

    </div>
</div>
          <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
          <div class="table-responsive">
            <table class="table table-borderless">
              <tbody>
                {% for item in order.order_items %}
                <tr class="border-bottom">
                  <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
       <td style="width: 120px; min-width: 120px;">
  <div class="d-flex justify-content-center flex-column align-items-center">
    {% if item.main_image %}
      <img src="{{ item.main_image | safe }}" alt="{{ item.name | safe }}"
           class="img-fluid rounded product-image mb-2"
           style="width: 160px; height: 160px; object-fit: cover;"
           loading="lazy">
    {% else %}
      <div class="bg-light d-flex align-items-center justify-content-center rounded product-image-placeholder mb-2" 
           style="width: 80px; height: 80px;">
        <i class="fas fa-image fa-lg text-muted"></i>
      </div>
    {% endif %}

<!-- Ø¨Ù€Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¹Ø¯Ù„ -->
{% if item.uploaded_images %}
  <div class="uploaded-images text-center mt-2">
    <h6 class="small text-muted mb-1">ØµÙˆØ± Ø§Ù„Ø¹Ù…ÙŠÙ„:</h6>
    <div class="d-flex flex-wrap justify-content-center gap-1">
      {% for img in item.uploaded_images %}
        {% if img.url %}
          <img src="{{ img.url }}" alt="{{ img.name | default('ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„') }}" 
               class="img-thumbnail rounded" 
               style="width: 60px; height: 60px; object-fit: cover;"
               onerror="this.style.display='none'">
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}
    <div class="text-center mt-1 small text-muted">
      Ø§Ù„ÙƒÙ…ÙŠØ©: {{ item.quantity }}
    </div>
  </div>
</td>
                  <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                  <td style="min-width: 150px;">
                    {% if item.options %}
                    <div class="text-start product-options">
                      <h6 class="mb-1 small text-muted">
                        <i class="fas fa-cogs me-1"></i>Ø®ÙŠØ§Ø±Ø§Øª
                      </h6>
                      <ul class="list-group list-group-flush small">
                        {% for option in item.options %}
                        <li class="list-group-item d-flex justify-content-between py-1 px-0 option-item">
                          <span class="fw-bold">{{ option.name | safe }}</span>
                          <span class="text-wrap text-end" style="max-width: 60%;">
                            {{ option.value | safe }}
                          </span>
                        </li>
                        {% endfor %}
                      </ul> 
                    </div>
                    {% else %}
                    <div class="alert alert-info p-1 mt-2 small">
                      <i class="fas fa-info-circle me-1"></i>
                      Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬
                    </div>
                    {% endif %}
                  </td>
                  
                  <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
                 </tr>
                <tr > <td>  {% if item.notes and item.notes.strip() %}
                            <div class="product-notes bg-light p-2 rounded">
                                <small class="text-primary">
                                    <i class="fas fa-sticky-note me-1"></i>
                                    {{ item.notes }}
                                </small>
                            </div>
                            {% else %}
                            <span class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                            {% endif %}</td>            <td class="text-center align-middle">
                    <div class="product-status-container" data-order-id="{{ order.id | string }}" data-product-id="{{ item.id | string }}">
                      <!-- Ø²Ø± ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° -->
                      <form class="update-product-status-form d-inline mb-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit"
                                class="btn btn-sm btn-success"
                                {% if product_statuses[item.id|string] and product_statuses[item.id|string].status == 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°' %}disabled{% endif %}>
                          <i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°
                        </button>
                      </form>

                      <!-- Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø© -->
                      {% if product_statuses[item.id|string] and product_statuses[item.id|string].status == 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°' %}
                      <form class="cancel-product-status-form d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-outline-danger">
                          <i class="fas fa-undo"></i>
                        </button>
                      </form>
                      {% endif %}
                    </div>
                  </td>
     </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="col-lg-4 bg-light p-3">
      <!-- Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…ÙˆØ¸Ù -->
   

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ© -->
      {% if is_reviewer %}
      <div class="card shadow-sm mb-3 border-0">
        <div class="card-header bg-white py-2">
          <h5 class="mb-0 fs-5"><i class="fas fa-flag ms-2"></i> ØªÙ†Ø¨ÙŠØ©</h5>
        </div>
        <div class="card-body p-2">
          <form action="{{ url_for('orders.add_status_note', order_id=order.id) }}" method="POST" id="special-status-form" class="ajax-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="mb-3">
              <label class="form-label small fw-bold">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø©</label>
              <select class="form-select form-select-sm" name="status_type" required>
                <option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© --</option>
                
                <!-- Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© -->
                <optgroup label="Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©">
                  <option value="late">Ù…ØªØ£Ø®Ø±</option>
                  <option value="missing">ÙˆØ§ØµÙ„ Ù†Ø§Ù‚Øµ</option>
                  <option value="refunded">Ù…Ø±ØªØ¬Ø¹</option>
                  <option value="not_shipped">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                </optgroup>
                
                <!-- Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© -->
                {% if custom_note_statuses %}
                <optgroup label="Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©">
                  {% for status in custom_note_statuses %}
                  <option value="custom_{{ status.id }}">
                    {{ status.name }}
                  </option>
                  {% endfor %}
                </optgroup>
                {% endif %}
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label small fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
              <textarea class="form-control form-control-sm" name="note" rows="3" 
                        placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary btn-sm w-100">
              <i class="fas fa-save me-1"></i> Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
            </button>
          </form>

          <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ø­Ø¯Ø© -->
          <div class="mt-4">
            <h6 class="border-bottom pb-2 mb-3 small fw-bold">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h6>
            <div class="list-group list-group-flush special-status-list">
              {% if status_notes %}
                {% for note in status_notes %}
                <div class="list-group-item py-2 px-0">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ù„ÙˆÙ†Ù‡Ø§ -->
                      <span class="badge" style="
                        {% if note.custom_status %} 
                          background-color: {{ note.custom_status.color }};
                        {% else %}
                          background-color: 
                            {% if note.status_flag == 'late' %}#ffc107
                            {% elif note.status_flag == 'missing' %}#dc3545
                            {% elif note.status_flag == 'not_shipped' %}#0dcaf0
                            {% elif note.status_flag == 'refunded' %}#6c757d
                            {% else %}#6c757d
                            {% endif %};
                        {% endif %} 
                        color: white;">
                        
                        {% if note.custom_status %}
                          <i class="fas fa-tag me-1"></i>{{ note.custom_status.name }}
                        {% else %}
                          <i class="fas fa-flag me-1"></i>
                          {{ 
                            'Ù…ØªØ£Ø®Ø±' if note.status_flag == 'late'
                            else 'ÙˆØ§ØµÙ„ Ù†Ø§Ù‚Øµ' if note.status_flag == 'missing'
                            else 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø´Ø­Ù†' if note.status_flag == 'not_shipped'
                            else 'Ù…Ø±ØªØ¬Ø¹' if note.status_flag == 'refunded'
                            else note.status_flag
                          }}
                        {% endif %}
                      </span>
                      
                      {% if note.note %}
                        <p class="mb-0 mt-1 small">{{ note.note }}</p>
                      {% endif %}
                    </div>
                    <div class="text-muted small text-end">
                      <div>{{ note.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <p class="text-muted text-center py-3 small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Ù‚Ø³Ù… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->

<!-- Ù‚Ø³Ù… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
<div class="card shadow-sm mb-3 border-0">
    <div class="card-header bg-white py-2">
        <h5 class="mb-0 fs-5"><i class="fas fa-sync-alt ms-2"></i>ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h5>
    </div>
    
    <div class="card-body p-2">
        <form id="status-form" action="{{ url_for('orders.update_order_status', order_id=order.id) }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="mb-2">
                <label for="status" class="form-label small">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                <select class="form-select form-select-sm" id="status" name="status_slug" required>
                    <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø©...</option>
                    {% for status in order_statuses %}
                        <option value="{{ status.slug }}" 
                                {% if order.status.slug == status.slug %}selected{% endif %}
                                data-status-type="{{ status.type }}"
                                style="color: {{ status.color or '#000' }}; {% if status.color %}font-weight: bold;{% endif %}">
                            {{ status.name }} 
                            {% if status.type %}{% endif %}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-2">
                <label for="note" class="form-label small">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea class="form-control form-control-sm" id="note" name="note" rows="2" 
                          placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..." maxlength="500"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary btn-sm w-100">
                <i class="fas fa-save me-1"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            </button>
        </form>
    </div>
</div>
        <!-- Ø³Ø¬Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø³Ù„Ø© -->
{% if status_changes %}
<div class="card mt-3">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-sync-alt me-2"></i>
            Ø³Ø¬Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø³Ù„Ø©
        </h6>
    </div>
    <div class="card-body p-2">
        <div class="list-group list-group-flush">
            {% for change in status_changes %}
            <div class="list-group-item d-flex justify-content-between align-items-center py-2">
                <div>
                    <small class="text-muted">{{ change.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                    <span class="badge bg-primary ms-2">{{ change.status_slug }}</span>
                </div>
                <div>
                    <small class="text-muted">
                        {{ change.changed_by }}
                        <span class="badge bg-secondary ms-1">
                            {{ 'Ù…Ø¯ÙŠØ±' if change.user_type == 'admin' else 'Ù…ÙˆØ¸Ù' }}
                        </span>
                    </small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}
      </div>
     

      <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->

{% if order_address %}
    <div class="card-body">
        <h4> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³ØªÙ„Ù…:</h4>
        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> {{ order_address.name }}</p>
        <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> {{ order_address.phone }}</p>
        <p> {{ order_address.city }}</p>
        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> {{ order_address.full_address }}</p>

        
    </div>
{% else %}
    <div class="address-info">
        <p>Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯</p>
    </div>

{% endif %}
    </div>
  </div>
</div>
<!-- Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù† -->

<!-- ÙÙŠ Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù† -->
<div class="shipping-section">
    <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†</h4>
    
    {% if order.shipping.has_shipping %}
        <div class="shipping-actions">
            <!-- Ø²Ø± Ø¨ÙˆÙ„ÙŠØµØ© Ø§Ù„Ø´Ø­Ù† -->
            {% if order.shipping.has_shipping_policy %}
            <a href="{{ order.shipping.shipping_policy_url }}" 
               target="_blank" 
               class="btn btn-primary btn-sm">
                <i class="fas fa-file-pdf"></i> Ø¹Ø±Ø¶ Ø¨ÙˆÙ„ÙŠØµØ© Ø§Ù„Ø´Ø­Ù†
            </a>
            {% endif %}
            
            <!-- Ø²Ø± ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù† -->
            {% if order.shipping.has_tracking %}
            <a href="{{ order.shipping.tracking_link }}" 
               target="_blank" 
               class="btn btn-info btn-sm">
                <i class="fas fa-truck"></i> ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©
            </a>
            {% endif %}
        </div>
        
        <!-- Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù†Ø§Øª -->
        {% for shipment in order.shipping.shipment_details %}
        <div class="shipment-detail">
            <h5>Ø§Ù„Ø´Ø­Ù†Ø© {{ loop.index }}</h5>
            <p><strong>Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†:</strong> {{ shipment.courier_name }}</p>
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø©:</strong> {{ shipment.status }}</p>
            
            {% if shipment.tracking_number %}
            <p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹:</strong> {{ shipment.tracking_number }}</p>
            {% endif %}
            
            <!-- Ø²Ø± Ø¨ÙˆÙ„ÙŠØµØ© Ø§Ù„Ø´Ø­Ù† Ù„Ù„Ø´Ø­Ù†Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© -->
            
    {% if shipment.has_shipping_policy %}
        <a href="{{ url_for('orders.download_shipping_policy', order_id=order.id, shipment_index=loop.index0) }}" 
           class="btn btn-primary btn-sm" 
           target="_blank">
            ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙˆÙ„ÙŠØµØ©
        </a>
    {% endif %}
    
        </div>
        
        {% endfor %}
    {% else %}
        <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø­Ù† Ù…ØªØ§Ø­Ø©</p>
    {% endif %}
</div>
<style>
  /* Ø£Ù†Ù…Ø§Ø· Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„ */
  .table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
  }
  
  .table tbody tr {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
  }
  
  /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù„Ù„Ø¬Ø¯ÙˆÙ„ */
  body.dark-mode .table tbody tr {
    background-color: #2c2f42;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  body.dark-mode .table {
    color: #f8f9fa;
  }
  
  body.dark-mode .table .text-muted {
    color: #adb5bd !important;
  }
  
  body.dark-mode .table .text-secondary {
    color: #a0aec0 !important;
  }
  
  body.dark-mode .table .text-dark {
    color: #f8f9fa !important;
  }
  
  body.dark-mode .table .border-bottom {
    border-bottom-color: #3a3f58 !important;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .img-fluid {
    border-color: #3a3f58;
  }
  
  body.dark-mode .bg-light {
    background-color: #3a3f58 !important;
    border-color: #444;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .list-group-flush {
    background-color: #2c2f42;
    border-color: #3a3f58;
  }
  
  body.dark-mode .list-group-item {
    background-color: #2c2f42 !important;
    border-color: #3a3f58 !important;
    color: #f8f9fa !important;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙÙˆØ±Ù…Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .form-control,
  body.dark-mode .form-select {
    background-color: #3a3f58;
    border-color: #444;
    color: #f8f9fa;
  }
  
  body.dark-mode .form-control:focus,
  body.dark-mode .form-select:focus {
    background-color: #3a3f58;
    border-color: #4a4f66;
    color: #f8f9fa;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .btn {
    transition: all 0.3s ease;
  }
  
  body.dark-mode .btn-primary {
    background-color: #3a86ff;
    border-color: #3a86ff;
    color: white;
  }
  
  body.dark-mode .btn-primary:hover {
    background-color: #2667cc;
    border-color: #2667cc;
  }
  
  body.dark-mode .btn-info {
    background-color: #00b4d8;
    border-color: #00b4d8;
    color: white;
  }
  
  body.dark-mode .btn-info:hover {
    background-color: #0096c7;
    border-color: #0096c7;
  }
  
  body.dark-mode .btn-success {
    background-color: #38b000;
    border-color: #38b000;
    color: white;
  }
  
  body.dark-mode .btn-success:hover {
    background-color: #2d8c00;
    border-color: #2d8c00;
  }
  
  body.dark-mode .btn-warning {
    background-color: #ff9e00;
    border-color: #ff9e00;
    color: #212529;
  }
  
  body.dark-mode .btn-warning:hover {
    background-color: #cc7e00;
    border-color: #cc7e00;
  }
  
  body.dark-mode .btn-danger {
    background-color: #e63946;
    border-color: #e63946;
    color: white;
  }
  
  body.dark-mode .btn-danger:hover {
    background-color: #c1121f;
    border-color: #c1121f;
  }
  
  body.dark-mode .btn-outline-secondary {
    color: #adb5bd;
    border-color: #4a4f66;
    background-color: transparent;
  }
  
  body.dark-mode .btn-outline-secondary:hover {
    background-color: #4a4f66;
    border-color: #5a5f76;
    color: #f8f9fa;
  }
  
  body.dark-mode .btn-outline-danger {
    color: #e63946;
    border-color: #e63946;
    background-color: transparent;
  }
  
  body.dark-mode .btn-outline-danger:hover {
    background-color: #e63946;
    border-color: #e63946;
    color: white;
  }
  
  body.dark-mode .btn-sm {
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Cards) ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .card {
    background-color: #2c2f42;
    border-color: #3a3f58;
  }
  
  body.dark-mode .card-header {
    background-color: #3a3f58 !important;
    border-bottom-color: #444 !important;
    color: #f8f9fa;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø®Ø±ÙŠØ·Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode iframe {
    filter: invert(90%) hue-rotate(180deg) brightness(85%) contrast(110%);
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .text-dark {
    color: #f8f9fa !important;
  }
  
  body.dark-mode .text-muted {
    color: #adb5bd !important;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Alerts) ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .alert-warning {
    background-color: #664d03;
    border-color: #846404;
    color: #ffecb5;
  }
  
  body.dark-mode .alert-info {
    background-color: #055160;
    border-color: #087990;
    color: #cff4fc;
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠÙ…Ù† */
  body.dark-mode .col-lg-4.bg-light {
    background-color: #252836 !important;
  }
  
  /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .table tbody tr {
    background-color: #2c2f42 !important;
    border-color: #3a3f58 !important;
  }

  body.dark-mode .table tbody td {
    background-color: #2c2f42 !important;
    border-color: #3a3f58 !important;
  }

  body.dark-mode .list-group-item {
    background-color: #2c2f42 !important;
    border-color: #3a3f58 !important;
    color: #f8f9fa !important;
  }

  body.dark-mode .text-muted {
    color: #adb5bd !important;
  }

  /* ØªØ­Ø³ÙŠÙ† ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .img-fluid {
    border: 1px solid #3a3f58;
  }

  body.dark-mode .bg-light {
    background-color: #3a3f58 !important;
  }

  /* ØªØ­Ø³ÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ */
  body.dark-mode .product-options {
    background-color: #3a3f58;
    border-color: #444;
  }

  body.dark-mode .product-options li {
    background-color: #2c2f42 !important;
    border-color: #3a3f58 !important;
  }

  /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ badges ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
  body.dark-mode .badge.bg-primary {
    background-color: #3a86ff !important;
  }
  
  body.dark-mode .badge.bg-success {
    background-color: #38b000 !important;
  }
  
  body.dark-mode .badge.bg-warning {
    background-color: #ff9e00 !important;
    color: #212529 !important;
  }
  
  body.dark-mode .badge.bg-info {
    background-color: #00b4d8 !important;
  }
  
  body.dark-mode .badge.bg-danger {
    background-color: #e63946 !important;
  }
  
  body.dark-mode .badge.bg-secondary {
    background-color: #6c757d !important;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ø·Ù„Ø© */
  body.dark-mode .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙŠ Ø§Ù„Ø±Ø£Ø³ */
  body.dark-mode .bg-light .btn-primary {
    box-shadow: 0 2px 4px rgba(58, 134, 255, 0.3);
  }

  body.dark-mode .bg-light .btn-info {
    box-shadow: 0 2px 4px rgba(0, 180, 216, 0.3);
  }

  body.dark-mode .bg-light .btn-outline-secondary {
    box-shadow: 0 2px 4px rgba(74, 79, 102, 0.3);
  }
</style>
<script>
// Ø§Ø³ØªØ®Ø¯Ø§Ù… event delegation Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
document.addEventListener('click', function(e) {
  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù†Ù‚Ø± Ø²Ø± "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°"
  if (e.target.closest('.update-product-status-form')) {
    e.preventDefault();
    const form = e.target.closest('.update-product-status-form');
    handleProductStatusUpdate(form);
  }
  
  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù†Ù‚Ø± Ø²Ø± "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©"
  if (e.target.closest('.cancel-product-status-form')) {
    e.preventDefault();
    const form = e.target.closest('.cancel-product-status-form');
    handleProductStatusCancel(form);
  }
});



// Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
function handleProductStatusUpdate(form) {
  const container = form.closest('.product-status-container');
  const orderId = container.dataset.orderId;
  const productId = container.dataset.productId;
  const button = form.querySelector('button');
  const csrfToken = form.querySelector('input[name="csrf_token"]').value;

  if (!productId || productId === 'undefined') {
    Swal.fire({
      title: 'Ø®Ø·Ø£!',
      text: 'Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± ØµØ§Ù„Ø­',
      icon: 'error',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    return;
  }

  // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ù…ÙŠÙ„
  const originalText = button.innerHTML;
  button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
  button.disabled = true;

  // Ø¥Ø±Ø³Ø§Ù„ AJAX Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­
  fetch(`/${encodeURIComponent(orderId)}/product/${encodeURIComponent(productId)}/update_status`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken
    },
    body: JSON.stringify({ 
      status: 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°', 
      notes: '' 
    })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    if (data.success) {
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      button.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°';
      button.disabled = true;

      // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø©
      const statusElement = container.querySelector('.product-status');
      if (statusElement) {
        statusElement.textContent = 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°';
        statusElement.classList.add('text-success', 'fw-bold');
      }

      // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
      let cancelForm = container.querySelector('.cancel-product-status-form');
      if (!cancelForm) {
        cancelForm = document.createElement('form');
        cancelForm.className = 'cancel-product-status-form d-inline';
        cancelForm.innerHTML = `
          <input type="hidden" name="csrf_token" value="${csrfToken}">
          <button type="submit" class="btn btn-sm btn-outline-danger">
            <i class="fas fa-undo"></i> Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©
          </button>
        `;
        // Ø¥Ø¯Ø±Ø§Ø¬ Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¨Ø¹Ø¯ Ø²Ø± Ø§Ù„ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°
        form.parentNode.insertBefore(cancelForm, form.nextSibling);
      }

      Swal.fire({
        title: 'ØªÙ…!',
        text: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    } else {
      throw new Error(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
    }
  })
  .catch(error => {
    button.innerHTML = originalText;
    button.disabled = false;
    Swal.fire({
      title: 'Ø®Ø·Ø£!',
      text: error.message,
      icon: 'error',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    console.error('Error:', error);
  });
}

// Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ù„ØºØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
function handleProductStatusCancel(form) {
  const container = form.closest('.product-status-container');
  const orderId = container.dataset.orderId;
  const productId = container.dataset.productId;
  const button = form.querySelector('button');
  const csrfToken = form.querySelector('input[name="csrf_token"]').value;

  if (!productId || productId === 'undefined') {
    Swal.fire({
      title: 'Ø®Ø·Ø£!',
      text: 'Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± ØµØ§Ù„Ø­',
      icon: 'error',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    return;
  }

  // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ù…ÙŠÙ„
  const originalText = button.innerHTML;
  button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù„ØºØ§Ø¡...';
  button.disabled = true;

  // Ø¥Ø±Ø³Ø§Ù„ AJAX Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©
  fetch(`/${encodeURIComponent(orderId)}/product/${encodeURIComponent(productId)}/cancel_status`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    if (data.success) {
      // Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
      form.remove();

      // ØªÙ…ÙƒÙŠÙ† Ø²Ø± "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°" Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
      const mainForm = container.querySelector('.update-product-status-form');
      const mainButton = mainForm.querySelector('button');
      mainButton.disabled = false;

      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
      const statusElement = container.querySelector('.product-status');
      if (statusElement) {
        statusElement.textContent = 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
        statusElement.classList.remove('text-success', 'fw-bold');
      }

      Swal.fire({
        title: 'ØªÙ…!',
        text: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    } else {
      throw new Error(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
    }
  })
  .catch(error => {
    button.innerHTML = originalText;
    button.disabled = false;
    Swal.fire({
      title: 'Ø®Ø·Ø£!',
      text: error.message,
      icon: 'error',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    console.error('Error:', error);
  });
}

// ØªØ­ÙˆÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ù„Ù‰ AJAX
document.addEventListener('DOMContentLoaded', function() {
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… AJAX
  const ajaxForms = document.querySelectorAll('.ajax-form');
  
  ajaxForms.forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      
      // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ù…ÙŠÙ„
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      submitButton.disabled = true;
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± AJAX
      fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          this.reset();
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          if (this.id === 'employee-status-form') {
            updateEmployeeStatusList(data.new_status);
          } else if (this.id === 'special-status-form') {
            updateSpecialStatusList(data.new_status);
          }
          
          Swal.fire({
            title: 'ØªÙ…!',
            text: data.message,
            icon: 'success',
            timer: 2000,
            showConfirmButton: false
          });
        } else {
          throw new Error(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
        }
      })
      .catch(error => {
        Swal.fire({
          title: 'Ø®Ø·Ø£!',
          text: error.message,
          icon: 'error',
          confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
      })
      .finally(() => {
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
      });
    });
  });
  
  // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
// ... (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
function updateEmployeeStatusList(newStatus) {
    const statusList = document.querySelector('.employee-status-list');
    
    if (newStatus && statusList) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯
        const newItem = document.createElement('li');
        newItem.className = 'list-group-item d-flex justify-content-between py-1 px-0';
        newItem.innerHTML = `
        <div>
            <span class="badge" style="background-color: ${newStatus.color}; color: white;">
                ${newStatus.name}
            </span>
            ${newStatus.note ? `<span class="ms-2">${newStatus.note}</span>` : ''}
            <div class="text-muted small mt-1">
                <i class="fas fa-user me-1"></i>${newStatus.employee_email}
            </div>
        </div>
        <div class="text-muted">${newStatus.created_at}</div>
        `;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø§ØµØ± ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (statusList.children.length > 0) {
            const firstChild = statusList.children[0];
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©"
            if (firstChild.classList && 
                (firstChild.classList.contains('text-center') || 
                 firstChild.textContent.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©'))) {
                statusList.removeChild(firstChild);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        statusList.insertBefore(newItem, statusList.firstChild);
    }
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
function updateSpecialStatusList(newStatus) {
    const statusList = document.querySelector('.special-status-list');
    
    if (newStatus && statusList) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯
        const newItem = document.createElement('div');
        newItem.className = 'list-group-item py-2 px-0';
        newItem.innerHTML = `
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <span class="badge" style="background-color: ${newStatus.color}; color: white;">
                    ${newStatus.name}
                </span>
                ${newStatus.note ? `<p class="mb-0 mt-1 small">${newStatus.note}</p>` : ''}
            </div>
            <div class="text-muted small text-end">
                <div>${newStatus.created_at}</div>
            </div>
        </div>
        `;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø§ØµØ± ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (statusList.children.length > 0) {
            const firstChild = statusList.children[0];
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©"
            if (firstChild.classList && 
                (firstChild.classList.contains('text-center') || 
                 firstChild.textContent.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©'))) {
                statusList.removeChild(firstChild);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        statusList.insertBefore(newItem, statusList.firstChild);
    }
}


  // Ø¥Ø¶Ø§ÙØ© ØªØ­Ù…ÙŠÙ„ Ù…ØªØ£Ø®Ø± Ù„Ù„ØµÙˆØ±
  const lazyImages = document.querySelectorAll('img[loading="lazy"]');
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        img.src = img.dataset.src || img.src;
        observer.unobserve(img);
      }
    });
  });

  lazyImages.forEach(img => {
    observer.observe(img);
  });
});

// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­
{% if request.args.get('status_updated') %}
Swal.fire({
  title: 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!',
  text: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­',
  icon: 'success',
  confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
  timer: 3000
});
{% endif %}

{% if request.args.get('employee_status_added') %}
Swal.fire({
  title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!',
  text: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ© Ø¨Ù†Ø¬Ø§Ø­',
  icon: 'success',
  confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
  timer: 3000
});
{% endif %}

{% if request.args.get('special_status_added') %}
Swal.fire({
  title: 'ØªÙ… Ø§Ù„Ø­ÙØ¸!',
  text: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø¬Ø§Ø­',
  icon: 'success',
  confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
  timer: 3000
});
{% endif %}
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
document.addEventListener('DOMContentLoaded', function() {
  const images = document.querySelectorAll('.uploaded-images img');
  images.forEach(img => {
    img.addEventListener('error', function() {
      this.style.display = 'none';
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¨Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
      const placeholder = document.createElement('div');
      placeholder.className = 'bg-light d-flex align-items-center justify-content-center rounded';
      placeholder.style.width = '60px';
      placeholder.style.height = '60px';
      placeholder.innerHTML = '<i class="fas fa-image text-muted"></i>';
      this.parentNode.insertBefore(placeholder, this);
    });
  });
});
</script>
{% endblock %}